version: '3.8'
services:
  web:
    build: .
    ports:
      - "8000:8000"
    environment:
      - OPENAI_API_KEY
      - DEBUG=1
    volumes:
      - ./media:/app/media
      - tts_models:/app/tts_models

  # TikTok listener runs as a separate service and posts comments to the web service
  tiktok:
    build: .
    command: ["python", "/app/scripts/tiktok_listener.py"]
    restart: unless-stopped
    depends_on:
      - web
    environment:
      - TIKTOK_USERNAME
      - TIKTOK_POST_URL=http://web:8000/tiktok/comment/
      - TIKTOK_SECRET
    volumes:
      - ./media:/app/media
      - tts_models:/app/tts_models

volumes:
  tts_models:
