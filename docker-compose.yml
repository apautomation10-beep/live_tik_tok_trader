services:
  web:
    build: .
    ports:
      - "8000:8000"
    environment:
      - OPENAI_API_KEY
      - DEBUG=1
      - NNPACK_DISABLE=1
    volumes:
      - ./media:/app/media
      - tts_models:/app/tts_models

  tiktok:
    build: .
    command: ["python", "/app/scripts/tiktok_listener.py"]
    restart: unless-stopped
    depends_on:
      - web
    environment:
      - TIKTOK_USERNAME
      - TIKTOK_POST_URL=http://web:8000/tiktok/comment/
      - TIKTOK_SECRET
      - NNPACK_DISABLE=1
    volumes:
      - ./media:/app/media
      - tts_models:/app/tts_models

  worker:
    build: .
    command: ["python", "/app/scripts/worker_tts.py"]
    restart: unless-stopped
    depends_on:
      - web
    environment:
      - NNPACK_DISABLE=1
      - OPENAI_API_KEY
      - OPENAI_MODEL=gpt-5-mini
      - OPENAI_MAX_TOKENS=16000
    volumes:
      - ./media:/app/media
      - tts_models:/app/tts_models

volumes:
  tts_models:
